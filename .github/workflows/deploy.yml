name: Deploy Firebase Function

on:
   push:
      branches:
         - main

jobs:
   deploy:
      name: Deploy Firebase Functions
      runs-on: ubuntu-latest

      steps:
         - name: Checkout Code
           uses: actions/checkout@v4.2.2

         - name: Set up Node.js
           uses: actions/setup-node@v4.1.0
           with:
              node-version: '20'
              cache: 'pnpm'

         - name: Install PNPM
           uses: pnpm/action-setup@v4

         - name: Install dependencies with PNPM
           run: pnpm install
           with:
              version: 9
              run_install: true

         - name: Run build
           run: pnpm build

         - uses: w9jds/setup-firebase@1.0.0
           with:
              tools-version: 13.27.0
              firebase_token: ${{ secrets.FIREBASE_TOKEN }}
         - run: firebase deploy --only functions
